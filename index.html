<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Odd or Even Cricket Game</title>
<style>
body { font-family: Arial; text-align:center; background:#f4f4f4; margin:0; padding:0; }
.container { max-width: 600px; margin:50px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.2);}
input, button { padding:10px; margin:10px; border-radius:6px; border:1px solid #ccc;}
button { cursor:pointer; background:#4CAF50; color:#fff; border:none;}
.hidden { display:none; }
#gameLog { text-align:left; margin-top:10px; max-height:200px; overflow-y:auto;}
</style>
</head>
<body>

<div class="container" id="loginSection">
  <h2>Login to Play</h2>
  <input type="text" id="playerName" placeholder="Enter your name"><br>
  <input type="email" id="playerEmail" placeholder="Enter your email"><br>
  <button onclick="loginPlayer()">Login</button>
  <p id="status"></p>
</div>

<div class="container hidden" id="gameSection">
  <h2>Odd or Even Cricket Game</h2>
  <p id="turnInfo">Enter a number (0‚Äì10)</p>
  <input type="number" id="playerInput" min="0" max="10" placeholder="0‚Äì10">
  <button onclick="playTurn()">Play</button>
  <div id="gameLog"></div>
  <p id="finalResult"></p>
  <button onclick="resetGame()">Restart Game</button>
</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbx-Y01Ya_oGEfw5YjtkQ9bAcXOxQxNTByLbEmj4a7nY5huwfUnv0LLcba4ySI2_Bit67w/exec";

let playerName = "";
let playerEmail = "";
let playerScore = 0;
let computerScore = 0;
let gamePhase = "toss"; // toss -> first innings -> second innings
let playerRole = ""; // batting/bowling
let targetScore = 0;
let secondInnings = false;
let gameOver = false;

// --- LOGIN ---
function loginPlayer() {
  const name = document.getElementById("playerName").value;
  const email = document.getElementById("playerEmail").value;
  if(!name || !email){ alert("Enter Name & Email"); return;}
  playerName = name; playerEmail = email;

  fetch(SHEET_URL, {
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ name, email, device:navigator.userAgent, score:"Not Played Yet" })
  }).then(()=>{
    document.getElementById("status").innerText="‚úÖ Login Success!";
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("gameSection").classList.remove("hidden");
    document.getElementById("turnInfo").innerText="Choose HEAD or TAILS for Toss";
  }).catch(err=>{
    document.getElementById("status").innerText="‚ùå Login Failed";
  });
}

// --- GAME LOGIC ---
function tossChoice(choice){
  const comp = Math.random()<0.5?"HEAD":"TAILS";
  if(choice===comp){
    playerRole = prompt("You won the toss! Choose your role: batting or bowling","batting") || "batting";
    alert(`Computer chose ${comp}. You are ${playerRole}`);
  } else {
    playerRole = comp==="HEAD"?"bowling":"batting";
    alert(`Computer won toss. You are ${playerRole}`);
  }
  gamePhase = playerRole;
  document.getElementById("turnInfo").innerText=`You are ${playerRole}. Enter 0‚Äì10`;
}

function playTurn() {
  if(gameOver) return;
  const playerNum = parseInt(document.getElementById("playerInput").value);
  if(isNaN(playerNum)||playerNum<0||playerNum>10){ alert("0‚Äì10 only"); return;}
  const compNum = Math.floor(Math.random()*11);
  let logEntry = `You: ${playerNum} | Computer: ${compNum}<br>`;

  if(gamePhase==="batting"){
    if(playerNum===compNum){
      logEntry+="‚ùå OUT!";
      if(!secondInnings){
        targetScore = playerScore;
        secondInnings=true;
        gamePhase="bowling";
        computerScore=0;
        document.getElementById("turnInfo").innerText=`You are bowling. Defend target ${targetScore}`;
      } else { endGame(); }
    } else { playerScore+=playerNum; }
  } else { // bowling
    if(playerNum===compNum){
      logEntry+="üí• Computer OUT!";
      if(!secondInnings){
        targetScore = computerScore;
        secondInnings=true;
        gamePhase="batting";
        playerScore=0;
        document.getElementById("turnInfo").innerText=`You are batting. Chase target ${targetScore}`;
      } else { endGame(); }
    } else { computerScore+=compNum; }
  }

  document.getElementById("gameLog").innerHTML+=logEntry;
  document.getElementById("playerInput").value="";
}

function endGame(){
  gameOver=true;
  let resultText="";
  if(playerScore>computerScore){ resultText="üéâ You Win!"; }
  else if(playerScore<computerScore){ resultText="üíî You Lose!"; }
  else{ resultText="ü§ù It's a Tie!"; }

  document.getElementById("finalResult").innerText=`Final Score - You: ${playerScore} | Computer: ${computerScore} | ${resultText}`;
  logScore(playerScore);
}

function logScore(finalScore){
  fetch(SHEET_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ name:playerName, email:playerEmail, device:navigator.userAgent, score:finalScore })
  }).then(()=>console.log("Score logged"))
  .catch(err=>console.error("Error logging score",err));
}

function resetGame(){
  playerScore=0; computerScore=0; secondInnings=false; gamePhase="toss"; gameOver=false;
  document.getElementById("gameLog").innerHTML="";
  document.getElementById("finalResult").innerText="";
  document.getElementById("turnInfo").innerText="Choose HEAD or TAILS for Toss";
}
</script>
</body>
</html>
