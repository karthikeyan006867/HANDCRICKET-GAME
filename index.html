<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèè Odd or Even Cricket Game - Ultimate Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #0a0a1a;
      --text-color: #fff;
      --container-bg: linear-gradient(145deg, #1a1a2e, #16213e);
      --container-text: #fff;
      --score-bg: rgba(255,255,255,0.1);
      --primary: #00d4ff;
      --secondary: #7c3aed;
      --accent: #f59e0b;
      --danger: #ef4444;
      --success: #10b981;
      --neon-glow: 0 0 20px rgba(0,212,255,0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      padding: 20px;
      transition: all 0.4s ease;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120,0,255,0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0,212,255,0.15) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(245,158,11,0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    body.light {
      --bg-color: #f0f4f8;
      --text-color: #1a1a2e;
      --container-bg: linear-gradient(145deg, #ffffff, #e8ecf0);
      --container-text: #1a1a2e;
      --score-bg: rgba(0,0,0,0.05);
    }

    body.purple {
      --bg-color: #2d1b69;
      --container-bg: linear-gradient(145deg, #3d2785, #4c1d95);
    }

    body.rainbow {
      background: linear-gradient(270deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff, #5f27cd);
      background-size: 600% 600%;
      animation: rainbowBG 8s ease infinite;
    }

    body.nightmare-mode {
      --bg-color: #0d0000;
      --container-bg: linear-gradient(145deg, #1a0000, #2d0000);
      animation: nightmareFlicker 0.1s infinite;
    }

    @keyframes rainbowBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes nightmareFlicker {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(0.95) hue-rotate(5deg); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-8px); }
      40%, 80% { transform: translateX(8px); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(0,212,255,0.3); }
      50% { box-shadow: 0 0 40px rgba(0,212,255,0.6), 0 0 60px rgba(0,212,255,0.3); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    @keyframes numberPop {
      0% { transform: scale(0); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .shake { animation: shake 0.5s ease; }
    .pulse { animation: pulse 0.5s ease; }
    .float { animation: float 3s ease-in-out infinite; }
    .glow { animation: glow 2s ease-in-out infinite; }

    .container {
      max-width: 500px;
      margin: auto;
      background: var(--container-bg);
      color: var(--container-text);
      padding: 30px;
      border-radius: 24px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
      position: relative;
      z-index: 1;
      animation: slideUp 0.6s ease;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Login/Register Screen */
    #login-screen {
      text-align: center;
    }

    #login-screen h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #login-screen .subtitle {
      color: rgba(255,255,255,0.7);
      margin-bottom: 30px;
      font-size: 1rem;
    }

    .login-emoji {
      font-size: 4rem;
      animation: float 3s ease-in-out infinite;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: rgba(255,255,255,0.8);
    }

    .input-group input {
      width: 100%;
      padding: 15px 20px;
      font-size: 1rem;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      background: rgba(255,255,255,0.1);
      color: var(--text-color);
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(0,212,255,0.3);
    }

    .input-group input::placeholder {
      color: rgba(255,255,255,0.4);
    }

    .login-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Header */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.1);
      padding: 8px 16px;
      border-radius: 50px;
    }

    .player-avatar {
      width: 35px;
      height: 35px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .player-name {
      font-weight: 600;
    }

    .player-rank {
      font-size: 0.8rem;
      color: var(--accent);
    }

    h2 {
      text-align: center;
      font-size: 1.8rem;
      margin: 15px 0;
      background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .top-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 20px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0,212,255,0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
    }

    button.success {
      background: linear-gradient(135deg, var(--success), #059669);
    }

    button.warning {
      background: linear-gradient(135deg, var(--accent), #d97706);
    }

    button.nightmare-btn {
      background: linear-gradient(135deg, #dc2626, #7f1d1d);
      animation: pulse 1s infinite;
    }

    button.small {
      padding: 8px 14px;
      font-size: 12px;
    }

    #message-box {
      background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(124,58,237,0.1));
      color: var(--text-color);
      padding: 20px;
      border-radius: 16px;
      margin: 20px 0;
      min-height: 60px;
      font-weight: 600;
      text-align: center;
      border: 1px solid rgba(0,212,255,0.2);
      animation: slideUp 0.4s ease;
    }

    .scoreboard {
      margin-top: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .score-card {
      background: var(--score-bg);
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }

    .score-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .score-card.player {
      border-color: var(--primary);
    }

    .score-card.computer {
      border-color: var(--danger);
    }

    .score-label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.7);
      margin-bottom: 8px;
    }

    .score-value {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .choices-display {
      margin-top: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .choice-card {
      background: var(--score-bg);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }

    .choice-label {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
      margin-bottom: 5px;
    }

    .choice-value {
      font-size: 2rem;
      font-weight: 700;
    }

    .choice-value.pop {
      animation: numberPop 0.3s ease;
    }

    #player-run {
      width: 100%;
      padding: 18px;
      font-size: 1.5rem;
      text-align: center;
      border: 2px solid rgba(0,212,255,0.3);
      border-radius: 16px;
      background: rgba(255,255,255,0.05);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }

    #player-run:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 30px rgba(0,212,255,0.3);
    }

    .center-buttons {
      text-align: center;
      margin: 20px 0;
    }

    .difficulty-box {
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(124,58,237,0.1));
      padding: 20px;
      border-radius: 16px;
      margin: 15px 0;
      text-align: center;
      border: 1px solid rgba(245,158,11,0.2);
      display: none;
    }

    .difficulty-box p {
      margin-bottom: 15px;
      font-weight: 600;
    }

    .difficulty-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .difficulty-box button.selected {
      box-shadow: 0 0 20px currentColor;
      transform: scale(1.05);
    }

    #game-status {
      text-align: center;
      font-weight: 700;
      font-size: 1.2rem;
      margin: 15px 0;
      padding: 15px;
      background: rgba(0,212,255,0.1);
      border-radius: 12px;
      border: 1px solid rgba(0,212,255,0.2);
    }

    /* Leaderboard Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--container-bg);
      padding: 30px;
      border-radius: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      animation: bounceIn 0.5s ease;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .close-modal {
      background: var(--danger);
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      padding: 0;
    }

    .leaderboard-list {
      list-style: none;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: var(--score-bg);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
    }

    .leaderboard-item.gold { border-left: 4px solid #ffd700; }
    .leaderboard-item.silver { border-left: 4px solid #c0c0c0; }
    .leaderboard-item.bronze { border-left: 4px solid #cd7f32; }

    .rank-badge {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      margin-right: 15px;
      background: rgba(255,255,255,0.1);
    }

    .rank-badge.gold { background: linear-gradient(135deg, #ffd700, #ffb700); color: #000; }
    .rank-badge.silver { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
    .rank-badge.bronze { background: linear-gradient(135deg, #cd7f32, #a0522d); color: #fff; }

    .player-details {
      flex: 1;
    }

    .player-details .name {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .player-details .stats {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    .player-details .wins {
      color: var(--success);
      font-weight: 600;
    }

    /* Stats Display */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .stat-item {
      background: var(--score-bg);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
    }

    /* Number Buttons */
    .number-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .number-btn {
      padding: 15px;
      font-size: 1.3rem;
      font-weight: 700;
      background: rgba(255,255,255,0.1);
      border: 2px solid rgba(0,212,255,0.3);
      border-radius: 12px;
      transition: all 0.2s ease;
    }

    .number-btn:hover {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-color: transparent;
      transform: scale(1.1);
    }

    .number-btn.selected {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-color: transparent;
      box-shadow: 0 0 20px rgba(0,212,255,0.5);
    }

    /* Confetti */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      top: -10px;
      z-index: 9999;
      animation: confetti 3s linear forwards;
    }

    /* Screenshot Preview */
    .screenshot-preview {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }

    .screenshot-preview img {
      max-width: 90%;
      max-height: 70%;
      border: 3px solid var(--primary);
      border-radius: 16px;
      box-shadow: 0 0 50px rgba(0,212,255,0.3);
    }

    .screenshot-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 9999;
      animation: bounceIn 0.5s ease, fadeOut 0.5s ease 4.5s forwards;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    @keyframes fadeOut {
      to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }

    /* Nightmare Warning */
    .nightmare-warning {
      background: linear-gradient(135deg, #7f1d1d, #450a0a);
      border: 2px solid #dc2626;
      color: #fecaca;
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
      animation: pulse 1s infinite;
    }

    .nightmare-warning .skull {
      font-size: 2rem;
      animation: shake 0.5s infinite;
    }

    /* Toss Animation */
    .coin {
      width: 80px;
      height: 80px;
      margin: 20px auto;
      position: relative;
      perspective: 1000px;
    }

    .coin-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffd700, #ffb700);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 5px 20px rgba(255,215,0,0.4);
      transition: transform 0.6s;
    }

    .coin.flipping .coin-inner {
      animation: coinFlip 1s ease;
    }

    @keyframes coinFlip {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(1800deg); }
    }

    @keyframes vibrate {
      0%, 100% { transform: translate(0); }
      10% { transform: translate(-2px, -2px); }
      20% { transform: translate(2px, -2px); }
      30% { transform: translate(-2px, 2px); }
      40% { transform: translate(2px, 2px); }
      50% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, -2px); }
      70% { transform: translate(-2px, 2px); }
      80% { transform: translate(2px, 2px); }
      90% { transform: translate(-2px, -2px); }
    }

    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0); }
      50% { opacity: 1; transform: scale(1); }
    }

    @keyframes ripple {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(4); opacity: 0; }
    }

    @keyframes scoreUp {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-50px); opacity: 0; }
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(1.1); }
    }

    .vibrate { animation: vibrate 0.3s linear; }
    .heartbeat { animation: heartbeat 0.6s ease; }

    /* Input Mode Toggle */
    .input-mode-toggle {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 15px;
      background: rgba(255,255,255,0.05);
      padding: 5px;
      border-radius: 50px;
    }

    .input-mode-toggle button {
      flex: 1;
      padding: 10px 15px;
      font-size: 12px;
      border-radius: 50px;
      background: transparent;
      color: rgba(255,255,255,0.6);
      border: none;
    }

    .input-mode-toggle button.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 5px 20px rgba(0,212,255,0.3);
    }

    /* Keyboard Input Mode */
    .keyboard-input-wrapper {
      display: none;
      margin-bottom: 15px;
    }

    .keyboard-input-wrapper.active {
      display: block;
    }

    .keyboard-input {
      width: 100%;
      padding: 20px;
      font-size: 2rem;
      text-align: center;
      border: 3px solid rgba(0,212,255,0.3);
      border-radius: 16px;
      background: rgba(255,255,255,0.05);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      transition: all 0.3s ease;
      letter-spacing: 5px;
    }

    .keyboard-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 30px rgba(0,212,255,0.4);
      animation: glow 1s ease infinite;
    }

    .keyboard-input::placeholder {
      color: rgba(255,255,255,0.3);
      letter-spacing: 0;
    }

    /* Button Grid Mode */
    .button-input-wrapper {
      display: block;
    }

    .button-input-wrapper.hidden {
      display: none;
    }

    /* Floating Score Animation */
    .score-popup {
      position: absolute;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--success);
      animation: scoreUp 1s ease forwards;
      pointer-events: none;
      z-index: 100;
    }

    .score-popup.negative {
      color: var(--danger);
    }

    /* Sparkle Effect */
    .sparkle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      animation: sparkle 0.6s ease forwards;
      pointer-events: none;
    }

    /* Ripple Effect */
    .ripple {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(0,212,255,0.3);
      animation: ripple 0.6s ease forwards;
      pointer-events: none;
    }

    /* Particles Background */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
      opacity: 0.5;
      animation: float 8s ease-in-out infinite;
    }

    /* Sound Toggle */
    .sound-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 5px 20px rgba(0,212,255,0.3);
      transition: all 0.3s ease;
    }

    .sound-toggle:hover {
      transform: scale(1.1);
    }

    .sound-toggle.muted {
      background: rgba(255,255,255,0.2);
    }

    /* Vibration Toggle */
    .vibration-indicator {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #d97706);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 5px 20px rgba(245,158,11,0.3);
      transition: all 0.3s ease;
    }

    .vibration-indicator:hover {
      transform: scale(1.1);
    }

    .vibration-indicator.disabled {
      background: rgba(255,255,255,0.2);
    }

    /* Enhanced Score Cards */
    .score-card {
      position: relative;
      overflow: hidden;
    }

    .score-card::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg);
      transition: 0.5s;
    }

    .score-card:hover::after {
      left: 100%;
    }

    /* Live Score Indicator */
    .live-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: var(--danger);
      border-radius: 50%;
      margin-right: 5px;
      animation: pulse 1s infinite;
    }

    /* Enhanced Leaderboard */
    .leaderboard-item {
      position: relative;
      overflow: hidden;
    }

    .leaderboard-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: 0.5s;
    }

    .leaderboard-item:hover::before {
      left: 100%;
    }

    .leaderboard-empty {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255,255,255,0.6);
    }

    .leaderboard-empty .icon {
      font-size: 4rem;
      margin-bottom: 15px;
      animation: float 3s ease-in-out infinite;
    }

    /* Target Display */
    .target-display {
      background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(245,158,11,0.2));
      border: 2px solid var(--accent);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin: 15px 0;
      animation: pulse 2s infinite;
    }

    .target-display .target-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent);
    }

    /* Responsive */
    @media (max-width: 480px) {
      .container { padding: 20px; }
      h2 { font-size: 1.4rem; }
      .number-grid { grid-template-columns: repeat(3, 1fr); }
      .top-controls { gap: 5px; }
      button { padding: 10px 14px; font-size: 12px; }
      .sound-toggle, .vibration-indicator { width: 40px; height: 40px; font-size: 1.2rem; }
      .keyboard-input { font-size: 1.5rem; padding: 15px; }
    }

    /* Hidden class */
    .hidden {
      display: none !important;
    }

    /* Score Popup */
    .score-popup {
      position: fixed;
      font-size: 2rem;
      font-weight: 800;
      color: var(--success);
      text-shadow: 0 0 10px rgba(16,185,129,0.5);
      pointer-events: none;
      z-index: 1000;
      animation: floatUp 1s ease forwards;
      transform: translateX(-50%);
    }

    .score-popup.negative {
      color: var(--danger);
      text-shadow: 0 0 10px rgba(239,68,68,0.5);
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateX(-50%) translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateX(-50%) translateY(-60px) scale(1.5);
      }
    }

    /* Screenshot Preview */
    .screenshot-preview {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .screenshot-preview img {
      max-width: 90%;
      max-height: 70vh;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    .screenshot-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    /* Vibrate animation */
    .vibrate {
      animation: vibrate 0.3s ease;
    }

    @keyframes vibrate {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
  </style>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body class="dark">
  <div class="container" id="main-container">
    <!-- Login/Register Screen -->
    <div id="login-screen">
      <div class="login-emoji">üèè</div>
      <h1>Odd or Even</h1>
      <p class="subtitle">The Ultimate Cricket Game ‚ú®</p>
      
      <div class="input-group">
        <label for="username-input">üë§ Enter Your Name</label>
        <input type="text" id="username-input" placeholder="Your awesome name..." maxlength="20" autocomplete="off">
      </div>
      
      <div class="login-buttons">
        <button onclick="handleLogin()" class="success">üöÄ Start Playing</button>
        <button onclick="showLeaderboard()" class="warning">üèÜ Leaderboard</button>
      </div>
      
      <p id="login-error" style="color: #ef4444; margin-top: 15px; display: none;"></p>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" style="display: none;">
      <div class="game-header">
        <div class="player-info">
          <div class="player-avatar" id="player-avatar">?</div>
          <div>
            <div class="player-name" id="display-name">Player</div>
            <div class="player-rank" id="display-rank">Rank: #--</div>
          </div>
        </div>
        <button onclick="logout()" class="danger small">üö™ Logout</button>
      </div>

      <div class="top-controls">
        <button onclick="toggleDifficulty()" class="small">üß† Difficulty</button>
        <button onclick="toggleTheme()" class="small">üé® Theme</button>
        <button onclick="showLeaderboard()" class="small warning">üèÜ Ranks</button>
        <button onclick="showStats()" class="small">üìä Stats</button>
      </div>

      <h2>üèè Odd or Even Cricket üèè</h2>

      <div id="message-box">Welcome! üëã Choose HEAD or TAILS to start the toss. ü™ô</div>

      <div class="difficulty-box" id="difficulty-box">
        <p>üéÆ Select Difficulty Level:</p>
        <div class="difficulty-buttons">
          <button onclick="setDifficulty('easy')" id="easy-btn" class="success">üòä Easy</button>
          <button onclick="setDifficulty('medium')" id="medium-btn" class="warning">üòê Medium</button>
          <button onclick="setDifficulty('hard')" id="hard-btn" class="danger">üòà Hard</button>
          <button onclick="setDifficulty('nightmare')" id="nightmare-btn" class="nightmare-btn">üíÄ Nightmare</button>
        </div>
        <div id="nightmare-warning" class="nightmare-warning" style="display: none;">
          <div class="skull">üíÄ‚ò†Ô∏èüíÄ</div>
          <p><strong>‚ö†Ô∏è WARNING:</strong> Nightmare mode is IMPOSSIBLE to win!</p>
          <p>The computer will cheat to ensure you lose. Are you brave enough?</p>
        </div>
      </div>

      <div id="toss-section" class="center-buttons">
        <div class="coin" id="coin">
          <div class="coin-inner">ü™ô</div>
        </div>
        <p style="margin-bottom: 15px;">Choose your side:</p>
        <button onclick="toss('head')" class="success">üëë HEAD</button>
        <button onclick="toss('tails')" class="warning">ü¶Ö TAILS</button>
      </div>

      <div id="choice-section" class="center-buttons" style="display:none;">
        <p style="margin-bottom: 15px;">üéØ You won the toss! Choose your role:</p>
        <button onclick="setChoice('batting')" class="success">üèè Batting</button>
        <button onclick="setChoice('bowling')" class="warning">‚öæ Bowling</button>
      </div>

      <div id="game-section" style="display:none;">
        <div id="game-status">üèè Game On!</div>
        
        <!-- Target Display (shows in 2nd innings) -->
        <div id="target-display" class="target-display" style="display: none;">
          <span class="live-indicator"></span> Target: <span class="target-value" id="target-value">0</span>
        </div>

        <!-- Input Mode Toggle -->
        <div class="input-mode-toggle">
          <button id="btn-mode" class="active" onclick="setInputMode('buttons')">üî¢ Buttons</button>
          <button id="keyboard-mode" onclick="setInputMode('keyboard')">‚å®Ô∏è Keyboard</button>
        </div>

        <!-- Button Input Mode -->
        <div class="button-input-wrapper" id="button-input-wrapper">
          <div class="number-grid" id="number-grid">
            <button class="number-btn" onclick="selectNumber(0, event)">0Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(1, event)">1Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(2, event)">2Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(3, event)">3Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(4, event)">4Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(5, event)">5Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(6, event)">6Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(7, event)">7Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(8, event)">8Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(9, event)">9Ô∏è‚É£</button>
            <button class="number-btn" onclick="selectNumber(10, event)">üîü</button>
            <button onclick="playRound()" class="success">‚ñ∂Ô∏è Play!</button>
          </div>
        </div>

        <!-- Keyboard Input Mode -->
        <div class="keyboard-input-wrapper" id="keyboard-input-wrapper">
          <input type="number" id="keyboard-input" class="keyboard-input" 
                 min="0" max="10" placeholder="Type 0-10..." 
                 oninput="validateKeyboardInput(this)">
          <button onclick="playRound()" class="success" style="width: 100%; margin-top: 10px;">‚ñ∂Ô∏è Play Round!</button>
        </div>

        <input type="hidden" id="player-run" value="" />

        <div class="choices-display">
          <div class="choice-card">
            <div class="choice-label">üë§ Your Choice</div>
            <div class="choice-value" id="player-choice-display">-</div>
          </div>
          <div class="choice-card">
            <div class="choice-label">ü§ñ Computer</div>
            <div class="choice-value" id="computer-choice-display">-</div>
          </div>
        </div>

        <div class="scoreboard">
          <div class="score-card player">
            <div class="score-label">üë§ Your Score</div>
            <div class="score-value" id="player-score">0</div>
          </div>
          <div class="score-card computer">
            <div class="score-label">ü§ñ Computer</div>
            <div class="score-value" id="computer-score">0</div>
          </div>
        </div>
      </div>

      <div class="center-buttons" style="margin-top: 20px;">
        <button onclick="resetGame()" class="danger">üîÑ New Game</button>
        <button id="screenshot-btn" onclick="captureAndShare()" class="success">üì∏ Share</button>
      </div>
    </div>

    <audio id="clapssound" src="https://assets.mixkit.co/sfx/preview/mixkit-applause-500.mp3"></audio>
    <audio id="losinghorn" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
    <audio id="coinflip" src="https://assets.mixkit.co/sfx/preview/mixkit-coins-handling-1939.mp3"></audio>
    <audio id="clicksound" src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3"></audio>
    <audio id="runsound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-bonus-alert-767.mp3"></audio>
    <audio id="outsound" src="https://assets.mixkit.co/sfx/preview/mixkit-losing-bleeps-2026.mp3"></audio>
    <audio id="wicketsound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="sixsound" src="https://assets.mixkit.co/sfx/preview/mixkit-video-game-win-2016.mp3"></audio>
    <audio id="foursound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
    <audio id="startsound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-level-music-689.mp3"></audio>
  </div>

  <!-- Floating Buttons -->
  <div class="sound-toggle" id="sound-toggle" onclick="toggleSound()" title="Toggle Sound">üîä</div>
  <div class="vibration-indicator" id="vibration-toggle" onclick="toggleVibration()" title="Toggle Vibration">üì≥</div>

  <!-- Particles Background -->
  <div class="particles" id="particles"></div>

  <!-- Leaderboard Modal -->
  <div class="modal" id="leaderboard-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üèÜ Leaderboard</h3>
        <button class="close-modal" onclick="closeLeaderboard()">√ó</button>
      </div>
      <ul class="leaderboard-list" id="leaderboard-list">
        <li style="text-align: center; padding: 20px;">Loading...</li>
      </ul>
    </div>
  </div>

  <!-- Stats Modal -->
  <div class="modal" id="stats-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üìä Your Stats</h3>
        <button class="close-modal" onclick="closeStats()">√ó</button>
      </div>
      <div class="stats-grid" id="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="stat-games">0</div>
          <div class="stat-label">Games Played</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-wins">0</div>
          <div class="stat-label">Wins üèÜ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-losses">0</div>
          <div class="stat-label">Losses üíî</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-winrate">0%</div>
          <div class="stat-label">Win Rate</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-highest">0</div>
          <div class="stat-label">Highest Score</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-streak">0</div>
          <div class="stat-label">Best Streak üî•</div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast-container"></div>

  <div id="popup-container"></div>

  <script>
    // API Configuration
    const API_URL = 'http://localhost:3000/api';
    
    // Game State
    let currentPlayer = null;
    let difficulty = 'easy';
    let themeClickCount = 0;
    let p_run = 0, c_run = 0;
    let playerChoice = '', gamePhase = 'toss', secondPhase = false;
    let prevMoves = [], sameChoiceCount = 0, lastPlayerInput = null;
    let selectedNumber = null;
    let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
    let vibrationEnabled = localStorage.getItem('vibrationEnabled') !== 'false';
    let inputMode = localStorage.getItem('inputMode') || 'buttons';

    // DOM Elements
    const playerRunInput = document.getElementById('player-run');
    const playerScoreDisplay = document.getElementById('player-score');
    const computerScoreDisplay = document.getElementById('computer-score');
    const playerChoiceDisplay = document.getElementById('player-choice-display');
    const computerChoiceDisplay = document.getElementById('computer-choice-display');
    const messageBox = document.getElementById('message-box');
    const gameStatus = document.getElementById('game-status');
    const container = document.getElementById('main-container');

    // Check for saved session
    window.onload = function() {
      const savedPlayer = localStorage.getItem('currentPlayer');
      if (savedPlayer) {
        currentPlayer = JSON.parse(savedPlayer);
        showGameScreen();
        updatePlayerDisplay();
      }
      
      // Initialize particles
      createParticles();
      
      // Restore sound/vibration settings
      soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
      vibrationEnabled = localStorage.getItem('vibrationEnabled') !== 'false';
      document.getElementById('sound-toggle').textContent = soundEnabled ? 'üîä' : 'üîá';
      document.getElementById('sound-toggle').classList.toggle('muted', !soundEnabled);
      document.getElementById('vibration-toggle').textContent = vibrationEnabled ? 'üì≥' : 'üì¥';
      document.getElementById('vibration-toggle').classList.toggle('disabled', !vibrationEnabled);
      
      // Restore input mode (only apply if game screen elements exist)
      const savedInputMode = localStorage.getItem('inputMode') || 'buttons';
      inputMode = savedInputMode;
      const btnMode = document.getElementById('btn-mode');
      const keyboardMode = document.getElementById('keyboard-mode');
      const buttonWrapper = document.getElementById('button-input-wrapper');
      const keyboardWrapper = document.getElementById('keyboard-input-wrapper');
      
      if (btnMode && keyboardMode && buttonWrapper && keyboardWrapper) {
        btnMode.classList.toggle('active', savedInputMode === 'buttons');
        keyboardMode.classList.toggle('active', savedInputMode === 'keyboard');
        buttonWrapper.classList.toggle('hidden', savedInputMode === 'keyboard');
        keyboardWrapper.classList.toggle('active', savedInputMode === 'keyboard');
      }
    };

    // ============ LOGIN/REGISTER ============
    async function handleLogin() {
      const usernameInput = document.getElementById('username-input');
      const errorDisplay = document.getElementById('login-error');
      const username = usernameInput.value.trim();

      if (!username || username.length < 2) {
        showError('Please enter a name (at least 2 characters)');
        vibrate([100, 50, 100]);
        return;
      }

      playSound('click');

      try {
        // Check if username exists
        const checkResponse = await fetch(`${API_URL}/check-username/${encodeURIComponent(username)}`);
        const checkData = await checkResponse.json();

        if (checkData.exists) {
          // Login existing player
          const loginResponse = await fetch(`${API_URL}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username })
          });
          
          if (loginResponse.ok) {
            const data = await loginResponse.json();
            currentPlayer = data.player;
            localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            showToast(`Welcome back, ${currentPlayer.username}! üéâ`);
            playSound('wicket');
            vibrate([100, 50, 100]);
            showGameScreen();
            updatePlayerDisplay();
          }
        } else {
          // Register new player
          const registerResponse = await fetch(`${API_URL}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username })
          });

          if (registerResponse.ok) {
            const data = await registerResponse.json();
            currentPlayer = data.player;
            localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            showToast(`Welcome, ${currentPlayer.username}! Let's play! üöÄ`);
            playSound('start');
            vibrate([100, 50, 100]);
            showGameScreen();
            updatePlayerDisplay();
          } else {
            const error = await registerResponse.json();
            showError(error.error || 'Registration failed');
            vibrate([100, 50, 100]);
          }
        }
      } catch (error) {
        console.error('Login error:', error);
        // Offline mode - create local player
        currentPlayer = {
          id: Date.now(),
          username: username,
          total_games: 0,
          total_wins: 0,
          total_losses: 0,
          highest_score: 0,
          max_win_streak: 0
        };
        localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
        showToast(`Playing offline as ${username} üéÆ`);
        playSound('click');
        showGameScreen();
        updatePlayerDisplay();
      }
    }

    function showError(message) {
      const errorDisplay = document.getElementById('login-error');
      errorDisplay.textContent = message;
      errorDisplay.style.display = 'block';
      setTimeout(() => errorDisplay.style.display = 'none', 3000);
    }

    function logout() {
      localStorage.removeItem('currentPlayer');
      currentPlayer = null;
      document.getElementById('login-screen').style.display = 'block';
      document.getElementById('game-screen').style.display = 'none';
      document.getElementById('username-input').value = '';
      resetGame();
    }

    function showGameScreen() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('game-screen').style.display = 'block';
    }

    async function updatePlayerDisplay() {
      if (!currentPlayer) return;
      
      document.getElementById('display-name').textContent = currentPlayer.username;
      document.getElementById('player-avatar').textContent = currentPlayer.username.charAt(0).toUpperCase();
      
      try {
        const rankResponse = await fetch(`${API_URL}/rank/${currentPlayer.id}`);
        if (rankResponse.ok) {
          const rankData = await rankResponse.json();
          document.getElementById('display-rank').textContent = `Rank: #${rankData.rank} of ${rankData.totalPlayers}`;
        }
      } catch (error) {
        document.getElementById('display-rank').textContent = 'Rank: #--';
      }
    }

    // ============ LEADERBOARD ============
    async function showLeaderboard() {
      document.getElementById('leaderboard-modal').classList.add('active');
      const list = document.getElementById('leaderboard-list');
      list.innerHTML = '<li style="text-align: center; padding: 20px;"><div class="login-emoji" style="font-size: 2rem;">‚è≥</div>Loading...</li>';
      
      playSound('click');
      
      try {
        const response = await fetch(`${API_URL}/leaderboard`);
        if (response.ok) {
          const players = await response.json();
          renderLeaderboard(players);
        } else {
          throw new Error('Failed to fetch');
        }
      } catch (error) {
        console.error('Leaderboard error:', error);
        list.innerHTML = `
          <div class="leaderboard-empty">
            <div class="icon">üèÜ</div>
            <p>Unable to load leaderboard</p>
            <p style="font-size: 0.8rem;">Play some games to see rankings!</p>
          </div>
        `;
      }
    }

    function renderLeaderboard(players) {
      const list = document.getElementById('leaderboard-list');
      
      if (!players || players.length === 0) {
        list.innerHTML = `
          <div class="leaderboard-empty">
            <div class="icon">üéÆ</div>
            <p>No players yet!</p>
            <p style="font-size: 0.8rem;">Be the first to play and claim the top spot!</p>
          </div>
        `;
        return;
      }
      
      list.innerHTML = players.map((player, index) => {
        const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`;
        const winRate = player.win_rate || 0;
        const totalWins = player.total_wins || 0;
        const totalLosses = player.total_losses || 0;
        const highestScore = player.highest_score || 0;
        const isCurrentPlayer = currentPlayer && player.username === currentPlayer.username;
        
        return `
          <li class="leaderboard-item ${rankClass}" style="${isCurrentPlayer ? 'border: 2px solid var(--primary); box-shadow: 0 0 15px rgba(0,212,255,0.3);' : ''}">
            <div class="rank-badge ${rankClass}">${medal}</div>
            <div class="player-details">
              <div class="name">${player.username} ${isCurrentPlayer ? '(You)' : ''}</div>
              <div class="stats">
                <span class="wins">${totalWins}W</span> / 
                ${totalLosses}L | 
                Best: ${highestScore} | 
                ${winRate}% WR
              </div>
            </div>
          </li>
        `;
      }).join('');
    }

    function closeLeaderboard() {
      document.getElementById('leaderboard-modal').classList.remove('active');
    }

    // ============ STATS ============
    async function showStats() {
      if (!currentPlayer) return;
      
      document.getElementById('stats-modal').classList.add('active');
      
      try {
        const response = await fetch(`${API_URL}/player/${currentPlayer.id}`);
        if (response.ok) {
          const stats = await response.json();
          document.getElementById('stat-games').textContent = stats.total_games || 0;
          document.getElementById('stat-wins').textContent = stats.total_wins || 0;
          document.getElementById('stat-losses').textContent = stats.total_losses || 0;
          document.getElementById('stat-highest').textContent = stats.highest_score || 0;
          document.getElementById('stat-streak').textContent = stats.max_win_streak || 0;
          
          const winRate = stats.total_games > 0 
            ? Math.round((stats.total_wins / stats.total_games) * 100) 
            : 0;
          document.getElementById('stat-winrate').textContent = `${winRate}%`;
        }
      } catch (error) {
        // Show local stats
        document.getElementById('stat-games').textContent = currentPlayer.total_games || 0;
        document.getElementById('stat-wins').textContent = currentPlayer.total_wins || 0;
        document.getElementById('stat-losses').textContent = currentPlayer.total_losses || 0;
        document.getElementById('stat-highest').textContent = currentPlayer.highest_score || 0;
        document.getElementById('stat-streak').textContent = currentPlayer.max_win_streak || 0;
      }
    }

    function closeStats() {
      document.getElementById('stats-modal').classList.remove('active');
    }

    // ============ THEME ============
    function toggleTheme() {
      const body = document.body;
      themeClickCount++;
      
      if (themeClickCount === 9) {
        body.className = 'rainbow';
        showToast("üåà Rainbow Theme Unlocked! ‚ú®");
        return;
      }
      
      const themes = ['dark', 'light', 'purple'];
      const currentTheme = body.className.split(' ')[0];
      let nextIndex = 0;
      
      for (let i = 0; i < themes.length; i++) {
        if (currentTheme === themes[i]) {
          nextIndex = (i + 1) % themes.length;
          break;
        }
      }
      
      body.className = themes[nextIndex];
      if (difficulty === 'nightmare') body.classList.add('nightmare-mode');
      showToast(`Theme: ${themes[nextIndex].charAt(0).toUpperCase() + themes[nextIndex].slice(1)} üé®`);
    }

    // ============ DIFFICULTY ============
    function toggleDifficulty() {
      const box = document.getElementById("difficulty-box");
      box.style.display = (box.style.display === "block") ? "none" : "block";
    }

    function setDifficulty(level) {
      difficulty = level;
      document.getElementById("difficulty-box").style.display = "none";
      
      // Update button styles
      ["easy", "medium", "hard", "nightmare"].forEach(id => {
        const btn = document.getElementById(`${id}-btn`);
        if (btn) btn.classList.remove("selected");
      });
      document.getElementById(`${level}-btn`).classList.add("selected");
      
      // Show/hide nightmare warning
      document.getElementById('nightmare-warning').style.display = 
        level === 'nightmare' ? 'block' : 'none';
      
      // Apply nightmare mode styling
      if (level === 'nightmare') {
        document.body.classList.add('nightmare-mode');
        showToast("üíÄ NIGHTMARE MODE ACTIVATED! Good luck... you'll need it! ‚ò†Ô∏è");
      } else {
        document.body.classList.remove('nightmare-mode');
        const difficultyEmoji = level === 'easy' ? 'üòä' : level === 'medium' ? 'üòê' : 'üòà';
        showToast(`Difficulty: ${level.charAt(0).toUpperCase() + level.slice(1)} ${difficultyEmoji}`);
      }
    }

    // ============ NUMBER SELECTION ============
    function selectNumber(num, e) {
      selectedNumber = num;
      playerRunInput.value = num;
      
      // Update button styles
      document.querySelectorAll('.number-btn').forEach(btn => btn.classList.remove('selected'));
      const btn = e ? e.target : document.querySelectorAll('.number-btn')[num];
      if (btn) {
        btn.classList.add('selected');
        btn.classList.add('heartbeat');
        setTimeout(() => btn.classList.remove('heartbeat'), 600);
      }
      
      playSound('click');
      vibrate([30]);
    }

    // ============ TOSS ============
    function toss(playerToss) {
      const coin = document.getElementById('coin');
      coin.classList.add('flipping');
      
      playSound('coin');
      vibrate([50, 30, 50, 30, 50]);
      
      setTimeout(() => {
        coin.classList.remove('flipping');
        
        const compToss = Math.random() < 0.5 ? 'head' : 'tails';
        const coinEmoji = compToss === 'head' ? 'üëë' : 'ü¶Ö';
        coin.querySelector('.coin-inner').textContent = coinEmoji;
        
        if (playerToss === compToss) {
          messageBox.innerHTML = `ü™ô You chose <strong>${playerToss}</strong>, Coin shows <strong>${compToss}</strong> ${coinEmoji}<br>üéâ You won the toss! Choose to Bat or Bowl.`;
          document.getElementById('toss-section').style.display = 'none';
          document.getElementById('choice-section').style.display = 'block';
          showToast("üéâ You won the toss!");
          playSound('wicket');
          vibrate([100, 50, 100]);
        } else {
          const compRole = Math.random() < 0.5 ? 'batting' : 'bowling';
          playerChoice = (compRole === 'batting') ? 'bowling' : 'batting';
          gamePhase = playerChoice;
          messageBox.innerHTML = `ü™ô You chose <strong>${playerToss}</strong>, Coin shows <strong>${compToss}</strong> ${coinEmoji}<br>ü§ñ Computer won and chose to ${compRole}. You are ${playerChoice}!`;
          document.getElementById('toss-section').style.display = 'none';
          showToast(`You are ${playerChoice}! ${playerChoice === 'batting' ? 'üèè' : '‚öæ'}`);
          playSound('out');
          vibrate([50, 50, 50]);
          setTimeout(startGame, 1500);
        }
      }, 1000);
    }

    function setChoice(choice) {
      playerChoice = choice;
      gamePhase = choice;
      document.getElementById('choice-section').style.display = 'none';
      showToast(`You chose ${choice}! ${choice === 'batting' ? 'üèè' : '‚öæ'}`);
      playSound('start');
      vibrate([100]);
      startGame();
    }

    function startGame() {
      document.getElementById('game-section').style.display = 'block';
      const phaseEmoji = playerChoice === 'batting' ? 'üèè' : '‚öæ';
      const inningsText = secondPhase ? ' (2nd Innings)' : '';
      gameStatus.innerHTML = `${phaseEmoji} You are <strong>${playerChoice.toUpperCase()}</strong>${inningsText}`;
      
      // Show target in 2nd innings
      if (secondPhase) {
        const targetDisplay = document.getElementById('target-display');
        targetDisplay.style.display = 'block';
        const target = playerChoice === 'batting' ? c_run + 1 : p_run + 1;
        document.getElementById('target-value').textContent = target;
      }
      
      // Focus keyboard input if in keyboard mode
      if (inputMode === 'keyboard') {
        document.getElementById('keyboard-input').focus();
      }
    }

    // ============ GAME LOGIC ============
    function generateComputerMove() {
      // NIGHTMARE MODE - Computer cheats to always win
      if (difficulty === 'nightmare') {
        const playerVal = parseInt(playerRunInput.value) || 0;
        
        if (gamePhase === 'batting') {
          // When player is batting, computer tries to get them out
          // 70% chance to match player's number (OUT!)
          if (Math.random() < 0.7) {
            return playerVal;
          }
          // Otherwise pick a number that minimizes player's score
          return Math.floor(Math.random() * 3); // Low numbers
        } else {
          // When computer is batting, never match player's number
          // Also pick high numbers to score more
          let computerNum;
          do {
            computerNum = Math.floor(Math.random() * 4) + 7; // 7-10
          } while (computerNum === playerVal);
          return computerNum;
        }
      }
      
      // Normal difficulty modes
      if (difficulty === 'easy') {
        return Math.floor(Math.random() * 11);
      }
      
      if (difficulty === 'medium') {
        const bias = Math.random() < 0.3 
          ? prevMoves[prevMoves.length - 1] || Math.floor(Math.random() * 11) 
          : Math.floor(Math.random() * 11);
        return Math.max(0, Math.min(10, bias));
      }
      
      if (difficulty === 'hard') {
        // Predict based on player's most common choice
        const freq = {};
        prevMoves.forEach(n => freq[n] = (freq[n] || 0) + 1);
        const sorted = Object.entries(freq).sort((a,b) => b[1] - a[1]);
        const predict = sorted.length ? parseInt(sorted[0][0]) : Math.floor(Math.random() * 11);
        const variation = Math.random() < 0.5 ? 0 : (Math.random() < 0.5 ? 1 : -1);
        return Math.max(0, Math.min(10, predict + variation));
      }
      
      return Math.floor(Math.random() * 11);
    }

    function playRound() {
      // Get value from either button mode or keyboard mode
      let val;
      if (inputMode === 'keyboard') {
        val = parseInt(document.getElementById('keyboard-input').value);
      } else {
        val = parseInt(playerRunInput.value);
      }
      
      if (isNaN(val) || val < 0 || val > 10) {
        messageBox.innerHTML = "‚ö†Ô∏è Please select a number between 0 and 10!";
        container.classList.add('shake');
        vibrate([100, 50, 100]);
        setTimeout(() => container.classList.remove('shake'), 500);
        return;
      }

      // Store in hidden input for consistency
      playerRunInput.value = val;
      
      // Check for repeated inputs
      if (val === lastPlayerInput) {
        sameChoiceCount++;
        if (sameChoiceCount === 3) {
          showToast("‚ö†Ô∏è Warning: Try different numbers!");
          vibrate([200]);
        }
        if (sameChoiceCount === 4) {
          showToast("üò¨ One more repeat and you're OUT!");
          vibrate([300, 100, 300]);
        }
      } else {
        sameChoiceCount = 1;
        lastPlayerInput = val;
      }

      // Auto-out for 5 same choices while batting
      if (sameChoiceCount >= 5 && gamePhase === 'batting') {
        messageBox.innerHTML = "‚ùå You used the same number 5 times! You're OUT!";
        playSound('out');
        animateOut();
        handleOut();
        return;
      }

      // Generate computer move
      const comp = generateComputerMove();
      const isOut = val === comp;
      prevMoves.push(val);
      
      // Animate choices
      playerChoiceDisplay.textContent = val;
      playerChoiceDisplay.classList.add('pop');
      computerChoiceDisplay.textContent = comp;
      computerChoiceDisplay.classList.add('pop');
      setTimeout(() => {
        playerChoiceDisplay.classList.remove('pop');
        computerChoiceDisplay.classList.remove('pop');
      }, 300);

      // Clear selection
      selectedNumber = null;
      playerRunInput.value = '';
      document.getElementById('keyboard-input').value = '';
      document.querySelectorAll('.number-btn').forEach(btn => btn.classList.remove('selected'));

      // Game logic
      if (gamePhase === 'batting') {
        if (isOut) {
          messageBox.innerHTML = `üí• OUT! Both chose ${val}!`;
          playSound('out');
          animateOut();
          handleOut();
        } else {
          const runs = val === 0 ? comp : val;
          p_run += runs;
          updateScores();
          showFloatingScore(runs, true);
          
          // Play appropriate sound
          if (runs >= 6) {
            playSound('six');
            showToast("üî• SIX! What a shot!");
            createSparkle(window.innerWidth / 2, window.innerHeight / 2);
          } else if (runs >= 4) {
            playSound('four');
            showToast("üí™ FOUR! Great hit!");
          } else {
            playSound('run');
          }
          
          vibrate([50]);
          
          const runEmoji = runs >= 6 ? 'üî•' : runs >= 4 ? 'üí™' : 'üëç';
          messageBox.innerHTML = `${runEmoji} +${runs} runs! Keep going!`;
          
          if (secondPhase && p_run > c_run) {
            win();
          }
        }
      } else {
        if (isOut) {
          messageBox.innerHTML = `üéØ WICKET! Both chose ${val}! Computer is OUT!`;
          playSound('wicket');
          animateOut();
          showToast("üéØ GOT 'EM! Wicket!");
          vibrate([100, 50, 100, 50, 100]);
          handleOut();
        } else {
          c_run += comp;
          updateScores();
          
          playSound('run');
          vibrate([30]);
          
          const dangerLevel = c_run > p_run ? 'üò∞' : c_run === p_run ? 'üòê' : 'üòä';
          messageBox.innerHTML = `${dangerLevel} Computer scored ${comp} runs. Total: ${c_run}`;
          
          if (secondPhase && c_run > p_run) {
            lose();
          }
        }
      }
    }

    function handleOut() {
      if (!secondPhase) {
        secondPhase = true;
        playerChoice = gamePhase === 'batting' ? 'bowling' : 'batting';
        gamePhase = playerChoice;
        
        setTimeout(() => {
          if (playerChoice === 'bowling') {
            messageBox.innerHTML = `üîÑ First innings over! Your score: ${p_run}<br>‚öæ Now BOWLING - Defend your score!`;
          } else {
            messageBox.innerHTML = `üîÑ First innings over! Target: ${c_run + 1}<br>üèè Now BATTING - Chase the score!`;
          }
          startGame();
        }, 1500);
      } else {
        endGame();
      }
    }

    function updateScores() {
      playerScoreDisplay.textContent = p_run;
      computerScoreDisplay.textContent = c_run;
      
      playerScoreDisplay.classList.add('pulse');
      computerScoreDisplay.classList.add('pulse');
      setTimeout(() => {
        playerScoreDisplay.classList.remove('pulse');
        computerScoreDisplay.classList.remove('pulse');
      }, 500);
    }

    async function endGame() {
      let result = '';
      let gameResult = '';
      
      if (p_run > c_run) {
        result = `
          <div style="font-size: 3rem; margin-bottom: 10px;">üéâüèÜüéâ</div>
          <strong>YOU WIN!</strong><br>
          Your Score: <strong>${p_run}</strong> | Computer: <strong>${c_run}</strong><br>
          Victory by ${p_run - c_run} runs! üéä
        `;
        gameResult = 'win';
        playSound('win');
        createConfetti();
      } else if (c_run > p_run) {
        result = `
          <div style="font-size: 3rem; margin-bottom: 10px;">üòîüíîüòî</div>
          <strong>YOU LOSE!</strong><br>
          Your Score: <strong>${p_run}</strong> | Computer: <strong>${c_run}</strong><br>
          ${difficulty === 'nightmare' ? 'Did you really expect to win Nightmare mode? üíÄ' : 'Better luck next time! üí™'}
        `;
        gameResult = 'loss';
        playSound('lose');
      } else {
        result = `
          <div style="font-size: 3rem; margin-bottom: 10px;">ü§ù</div>
          <strong>IT'S A TIE!</strong><br>
          Both scored: <strong>${p_run}</strong> runs!<br>
          What a match! üé≠
        `;
        gameResult = 'tie';
      }
      
      messageBox.innerHTML = result;
      document.getElementById('game-section').style.display = 'none';
      
      // Save game to database
      if (currentPlayer) {
        try {
          await fetch(`${API_URL}/save-game`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              playerId: currentPlayer.id,
              playerScore: p_run,
              computerScore: c_run,
              result: gameResult,
              difficulty: difficulty
            })
          });
          
          // Refresh player stats
          const response = await fetch(`${API_URL}/player/${currentPlayer.id}`);
          if (response.ok) {
            currentPlayer = await response.json();
            localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            updatePlayerDisplay();
          }
        } catch (error) {
          console.error('Error saving game:', error);
          // Update local stats
          currentPlayer.total_games = (currentPlayer.total_games || 0) + 1;
          if (gameResult === 'win') currentPlayer.total_wins = (currentPlayer.total_wins || 0) + 1;
          if (gameResult === 'loss') currentPlayer.total_losses = (currentPlayer.total_losses || 0) + 1;
          currentPlayer.highest_score = Math.max(currentPlayer.highest_score || 0, p_run);
          localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
        }
      }
    }

    function win() {
      endGame();
    }

    function lose() {
      endGame();
    }

    function playSound(type) {
      if (soundEnabled === false) return;
      
      let soundId;
      switch(type) {
        case 'win': soundId = 'clapssound'; break;
        case 'lose': soundId = 'losinghorn'; break;
        case 'click': soundId = 'clicksound'; break;
        case 'run': soundId = 'runsound'; break;
        case 'out': soundId = 'outsound'; break;
        case 'wicket': soundId = 'wicketsound'; break;
        case 'six': soundId = 'sixsound'; break;
        case 'four': soundId = 'foursound'; break;
        case 'coin': soundId = 'coinflip'; break;
        case 'start': soundId = 'startsound'; break;
        default: soundId = 'clicksound';
      }
      
      const soundElement = document.getElementById(soundId);
      if (soundElement) {
        soundElement.currentTime = 0;
        soundElement.volume = 0.5;
        soundElement.play().catch(() => {});
      }
    }

    // ============ VIBRATION ============
    function vibrate(pattern = [50]) {
      if (vibrationEnabled && navigator.vibrate) {
        navigator.vibrate(pattern);
      }
    }

    function toggleVibration() {
      vibrationEnabled = !vibrationEnabled;
      const toggle = document.getElementById('vibration-toggle');
      toggle.classList.toggle('disabled', !vibrationEnabled);
      toggle.textContent = vibrationEnabled ? 'üì≥' : 'üì¥';
      localStorage.setItem('vibrationEnabled', vibrationEnabled);
      showToast(vibrationEnabled ? 'üì≥ Vibration ON' : 'üì¥ Vibration OFF');
      if (vibrationEnabled) vibrate([100, 50, 100]);
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const toggle = document.getElementById('sound-toggle');
      toggle.classList.toggle('muted', !soundEnabled);
      toggle.textContent = soundEnabled ? 'üîä' : 'üîá';
      localStorage.setItem('soundEnabled', soundEnabled);
      showToast(soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF');
      if (soundEnabled) playSound('click');
    }

    // ============ INPUT MODE ============
    function setInputMode(mode) {
      inputMode = mode;
      document.getElementById('btn-mode').classList.toggle('active', mode === 'buttons');
      document.getElementById('keyboard-mode').classList.toggle('active', mode === 'keyboard');
      document.getElementById('button-input-wrapper').classList.toggle('hidden', mode === 'keyboard');
      document.getElementById('keyboard-input-wrapper').classList.toggle('active', mode === 'keyboard');
      
      if (mode === 'keyboard') {
        document.getElementById('keyboard-input').focus();
      }
      
      playSound('click');
      localStorage.setItem('inputMode', mode);
    }

    function validateKeyboardInput(input) {
      let value = input.value;
      
      // Handle "10" as special case
      if (value.length > 2) {
        value = value.slice(0, 2);
      }
      
      if (value === '' || value === '1' || value === '10') {
        // Valid
      } else if (parseInt(value) >= 0 && parseInt(value) <= 10) {
        // Valid
      } else if (parseInt(value) > 10) {
        value = '10';
      }
      
      input.value = value;
      
      if (value !== '' && parseInt(value) >= 0 && parseInt(value) <= 10) {
        playerRunInput.value = parseInt(value);
        vibrate([30]);
      }
    }

    // ============ PARTICLES BACKGROUND ============
    function createParticles() {
      const container = document.getElementById('particles');
      const particleCount = 30;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
        particle.style.opacity = Math.random() * 0.5 + 0.2;
        particle.style.width = (Math.random() * 4 + 2) + 'px';
        particle.style.height = particle.style.width;
        container.appendChild(particle);
      }
    }

    // ============ SPARKLE EFFECT ============
    function createSparkle(x, y) {
      for (let i = 0; i < 5; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = (x + Math.random() * 40 - 20) + 'px';
        sparkle.style.top = (y + Math.random() * 40 - 20) + 'px';
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 600);
      }
    }

    // ============ FLOATING SCORE ============
    function showFloatingScore(value, isPositive = true) {
      const scoreCard = document.querySelector('.score-card.player');
      const rect = scoreCard.getBoundingClientRect();
      
      const popup = document.createElement('div');
      popup.className = 'score-popup' + (isPositive ? '' : ' negative');
      popup.textContent = (isPositive ? '+' : '') + value;
      popup.style.left = rect.left + rect.width / 2 + 'px';
      popup.style.top = rect.top + 'px';
      document.body.appendChild(popup);
      
      setTimeout(() => popup.remove(), 1000);
    }

    function resetGame() {
      p_run = 0;
      c_run = 0;
      secondPhase = false;
      gamePhase = 'toss';
      prevMoves = [];
      sameChoiceCount = 0;
      lastPlayerInput = null;
      selectedNumber = null;
      
      updateScores();
      playerChoiceDisplay.textContent = "-";
      computerChoiceDisplay.textContent = "-";
      messageBox.innerHTML = "Welcome! üëã Choose HEAD or TAILS to start the toss. ü™ô";
      gameStatus.textContent = '';
      
      document.getElementById('game-section').style.display = 'none';
      document.getElementById('toss-section').style.display = 'block';
      document.getElementById('choice-section').style.display = 'none';
      document.getElementById('coin').querySelector('.coin-inner').textContent = 'ü™ô';
      document.getElementById('target-display').style.display = 'none';
      
      document.querySelectorAll('.number-btn').forEach(btn => btn.classList.remove('selected'));
      playerRunInput.value = '';
      document.getElementById('keyboard-input').value = '';
      
      playSound('click');
      vibrate([50]);
    }

    // ============ EFFECTS ============
    function showToast(message) {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.innerText = message;
      document.getElementById("toast-container").appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }

    function animateOut() {
      container.classList.add("shake");
      container.classList.add("vibrate");
      vibrate([100, 50, 100, 50, 100]);
      setTimeout(() => {
        container.classList.remove("shake");
        container.classList.remove("vibrate");
      }, 600);
    }

    function createConfetti() {
      const colors = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd', '#00d4ff', '#10b981'];
      
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 5000);
      }
      
      vibrate([200, 100, 200, 100, 200]);
    }

    // ============ SCREENSHOT ============
    function captureAndShare() {
      const screenshotBtn = document.getElementById('screenshot-btn');
      screenshotBtn.disabled = true;
      showToast("üì∏ Preparing screenshot...");
      
      if (typeof html2canvas === 'undefined') {
        showToast("Screenshot library not loaded üòî");
        screenshotBtn.disabled = false;
        return;
      }
      
      html2canvas(container, {
        useCORS: true,
        allowTaint: true,
        scale: 2,
        backgroundColor: '#0a0a1a'
      })
      .then(canvas => {
        showScreenshotPreview(canvas);
        screenshotBtn.disabled = false;
      })
      .catch(error => {
        console.error("Screenshot failed:", error);
        showToast("Screenshot failed üòî");
        screenshotBtn.disabled = false;
      });
    }

    function showScreenshotPreview(canvas) {
      const preview = document.createElement('div');
      preview.className = 'screenshot-preview';
      
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png');
      
      const buttonsDiv = document.createElement('div');
      buttonsDiv.className = 'screenshot-buttons';
      
      const downloadBtn = document.createElement('button');
      downloadBtn.className = 'success';
      downloadBtn.innerHTML = 'üíæ Download';
      downloadBtn.onclick = function() {
        const link = document.createElement('a');
        link.download = `cricket-game-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      };
      
      const shareBtn = document.createElement('button');
      shareBtn.className = 'warning';
      shareBtn.innerHTML = 'üì§ Share';
      shareBtn.onclick = function() {
        const text = `üèè I scored ${p_run} runs against the computer's ${c_run} in Odd or Even Cricket! ${p_run > c_run ? 'üèÜ I WON!' : p_run < c_run ? 'üíî Lost' : 'ü§ù Tie'}`;
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
        window.open(whatsappUrl, '_blank');
      };
      
      const closeBtn = document.createElement('button');
      closeBtn.className = 'danger';
      closeBtn.innerHTML = '‚úñ Close';
      closeBtn.onclick = function() {
        document.body.removeChild(preview);
      };
      
      buttonsDiv.appendChild(downloadBtn);
      buttonsDiv.appendChild(shareBtn);
      buttonsDiv.appendChild(closeBtn);
      
      preview.appendChild(img);
      preview.appendChild(buttonsDiv);
      document.body.appendChild(preview);
    }

    // Keyboard shortcuts
    document.addEventListener("keydown", function(e) {
      // Don't process if typing in inputs
      if (e.target.tagName === 'INPUT' && e.target.id !== 'keyboard-input') return;
      
      if (e.key === "Enter") {
        e.preventDefault();
        playRound();
      }
      
      // Number keys for button mode
      if (inputMode === 'buttons') {
        if (e.key >= '0' && e.key <= '9') {
          const num = parseInt(e.key);
          selectNumber(num, null);
        }
        // Special case for "10" - press 1 then 0 quickly
        if (e.key === '0' && playerRunInput.value === '1') {
          selectNumber(10, null);
        }
      }
    });

    // Handle Enter on username input
    document.getElementById('username-input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') handleLogin();
    });

    // Handle Enter on keyboard input
    document.getElementById('keyboard-input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        playRound();
      }
    });

    // Click anywhere to close modals
    document.getElementById('leaderboard-modal').addEventListener('click', function(e) {
      if (e.target === this) closeLeaderboard();
    });

    document.getElementById('stats-modal').addEventListener('click', function(e) {
      if (e.target === this) closeStats();
    });

    // Add ripple effect to buttons
    document.addEventListener('click', function(e) {
      if (e.target.tagName === 'BUTTON') {
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        ripple.style.left = e.offsetX + 'px';
        ripple.style.top = e.offsetY + 'px';
        e.target.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }
    });
  </script>
</body>
</html>
